{"version":3,"file":"lrn-math.umd.js","sources":["lrn-math.umd.js"],"sourcesContent":["// forked from https://github.com/janmarthedal/math-tex\nconst document = window.document,\n  states = { start: 1, loading: 2, ready: 3, typesetting: 4, error: 5 };\nlet mathjaxHub,\n  typesets = [],\n  state = states.start,\n  styleNode,\n  src = \"https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js\";\n\nfunction getStyleNode() {\n  const styleNodes = document.querySelectorAll(\"style\");\n  const sn = Array.prototype.filter.call(styleNodes, function(n) {\n    return (\n      n.sheet &&\n      n.sheet.cssRules.length > 100 &&\n      n.sheet.cssRules[0].selectorText === \".mjx-chtml\"\n    );\n  });\n  styleNode = sn[0];\n}\n\n// precondition: state === states.ready\nfunction flush_typesets() {\n  if (!typesets.length) return;\n  const jaxs = [],\n    items = [];\n  typesets.forEach(function(item) {\n    const script = document.createElement(\"script\"),\n      div = document.createElement(\"div\");\n    script.type = item[1] ? \"math/tex; mode=display\" : \"math/tex\";\n    script.text = item[0];\n    div.style.position = \"fixed\";\n    div.style.top = 0;\n    div.style.left = \"99999px\";\n    div.appendChild(script);\n    document.body.appendChild(div);\n    jaxs.push(script);\n    items.push([div, item[2]]);\n  });\n  typesets = [];\n  state = states.typesetting;\n  mathjaxHub.Queue([\"Typeset\", mathjaxHub, jaxs]);\n  mathjaxHub.Queue(function() {\n    if (!styleNode) getStyleNode();\n    items.forEach(function(item) {\n      const div = item[0];\n      const result =\n        div.firstElementChild.tagName === \"SPAN\" ? div.firstElementChild : null;\n      item[1](result, styleNode);\n      document.body.removeChild(div);\n    });\n    state = states.ready;\n    flush_typesets();\n  });\n}\n\nfunction load_library() {\n  state = states.loading;\n  window.MathJax = {\n    skipStartupTypeset: true,\n    showMathMenu: false,\n    jax: [\"input/TeX\", \"output/CommonHTML\"],\n    TeX: {\n      extensions: [\n        \"AMSmath.js\",\n        \"AMSsymbols.js\",\n        \"noErrors.js\",\n        \"noUndefined.js\"\n      ]\n    },\n    AuthorInit() {\n      mathjaxHub = window.MathJax.Hub;\n      mathjaxHub.Register.StartupHook(\"End\", function() {\n        state = states.ready;\n        flush_typesets();\n      });\n    }\n  };\n  var script = document.createElement(\"script\");\n  script.type = \"text/javascript\";\n  script.src = src;\n  script.async = true;\n  script.onerror = function() {\n    console.warn(\"Error loading MathJax library \" + src);\n    state = states.error;\n    typesets = [];\n  };\n  document.head.appendChild(script);\n}\n\nclass LrnMathController extends HTMLElement {\n  connectedCallback() {\n    if (this.hasAttribute(\"src\")) src = this.getAttribute(\"src\");\n    if (!this.hasAttribute(\"lazy\")) load_library();\n  }\n\n  typeset(math, displayMode, cb) {\n    if (state === states.error) return;\n    typesets.push([math, displayMode, cb]);\n    if (state === states.start) load_library();\n    else if (state === states.ready) flush_typesets();\n  }\n}\n\nexport { LrnMathController };\n\nwindow.customElements.define(\"lrn-math-controller\", LrnMathController);\n/*\nTypesets math written in (La)TeX, using [MathJax](http://mathjax.org).\n##### Example\n    <math-tex>c = \\sqrt{a^2 + b^2}</math-tex>\n##### Example\n    <math-tex mode=\"display\">\\sum_{k=1}^n k = \\frac{n (n + 1)}{2}</math-tex>\n@element math-tex\n@version 0.3.2\n@homepage http://github.com/janmarthedal/math-tex/\n*/\nconst TAG_NAME = \"lrn-math\",\n  CONTROLLER_TAG_NAME = \"lrn-math-controller\",\n  mutation_config = {\n    childList: true,\n    characterData: true,\n    attributes: true,\n    subtree: true\n  };\nlet handler;\n\nfunction check_handler() {\n  if (handler) return;\n  handler =\n    document.querySelector(CONTROLLER_TAG_NAME) ||\n    document.createElement(CONTROLLER_TAG_NAME);\n  handler.setAttribute(\"lazy\", \"lazy\");\n  if (!handler || typeof handler.typeset !== \"function\") {\n    console.warn(\n      \"no %s element defined; %s element will not work\",\n      CONTROLLER_TAG_NAME,\n      TAG_NAME\n    );\n    handler = undefined;\n  } else if (!document.contains(handler)) document.head.appendChild(handler);\n}\n\nfunction update(elem) {\n  const sdom = elem.shadowRoot,\n    math = elem.textContent.trim(),\n    isBlock = elem.getAttribute(\"mode\") === \"display\",\n    check = (isBlock ? \"D\" : \"I\") + math;\n  if (check !== elem._private.check) {\n    while (sdom.firstChild) sdom.removeChild(sdom.firstChild);\n    elem._private.check = check;\n    if (math.length) {\n      handler.typeset(math, isBlock, function(melem, styleNode) {\n        sdom.appendChild(styleNode.cloneNode(true));\n        sdom.appendChild(melem);\n      });\n    }\n  }\n}\n\n// Returns a function, that, as long as it continues to be invoked, will not\n// be triggered. The function will be called after it stops being called for\n// `wait` milliseconds.\n// https://levelup.gitconnected.com/debounce-in-javascript-improve-your-applications-performance-5b01855e086\nconst debounce = (func, wait) => {\n  let timeout;\n\n  return function executedFunction(...args) {\n    const later = () => {\n      clearTimeout(timeout);\n      func(...args);\n    };\n\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n  };\n};\n\n/**\n * lrn-math\n * A mathjax wrapper tag in vanillaJS\n *\n * @demo demo/index.html\n */\nclass LrnMath extends HTMLElement {\n  constructor() {\n    super();\n    this.attachShadow({ mode: \"open\" });\n  }\n  static get tag() {\n    return \"lrn-math\";\n  }\n\n  connectedCallback() {\n    const elem = this;\n    check_handler();\n    window.requestAnimationFrame(function() {\n      elem._private = {\n        check: \"\",\n        observer: new MutationObserver(\n          debounce(function() {\n            update(elem);\n          }, 300)\n        )\n      };\n      update(elem);\n      elem._private.observer.observe(elem, mutation_config);\n    });\n  }\n\n  /**\n   * Use Math-Text as a method for transfering values\n   * from hax inline text to the slot.\n   */\n  static get observedAttributes() {\n    return [\"math-text\"];\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    switch (name) {\n      case \"math-text\":\n        if (newValue !== \"\" && newValue !== null) {\n          // If a value has been set then wrap it in a\n          // span tag and inject it into the lightdom\n          const container = document.createElement(\"span\");\n          container.innerText = newValue;\n          this.innerHTML = \"\";\n          this.appendChild(container);\n          this.removeAttribute(\"math-text\");\n        }\n        break;\n    }\n  }\n\n  static get haxProperties() {\n    return {\n      canScale: true,\n      canPosition: true,\n      canEditSource: true,\n      gizmo: {\n        title: \"Math\",\n        description: \"Present math in a nice looking way.\",\n        icon: \"hax:pi\",\n        iconLib: \"@lrnwebcomponents/hax-iconset/hax-iconset.js\",\n        color: \"grey\",\n        groups: [\"Content\"],\n        handles: [\n          {\n            type: \"math\",\n            math: \"mathText\"\n          },\n          {\n            type: \"inline\",\n            text: \"mathText\"\n          }\n        ],\n        meta: {\n          author: \"ELMS:LN\",\n          inlineOnly: true\n        }\n      },\n      settings: {\n        quick: [],\n        configure: [\n          {\n            slot: \"\",\n            title: \"Math\",\n            description: \"Enter equation as MathML\",\n            inputMethod: \"code-editor\",\n            icon: \"editor:format-quote\"\n          }\n        ],\n        advanced: []\n      }\n    };\n  }\n  /**\n   * forces a refresh to prevent dom reattachment issue\n   */\n  refresh() {\n    let root = this;\n    let clone = document.createElement(\"lrn-math\");\n    root.parentNode.insertBefore(clone, root);\n    clone.innerHTML = this.innerHTML;\n    this.remove();\n  }\n\n  disconnectedCallback() {\n    if (this._private) {\n      this._private.observer.disconnect();\n      delete this._private;\n    }\n  }\n}\n\nwindow.customElements.define(LrnMath.tag, LrnMath);\nexport { LrnMath };\n"],"names":["mathjaxHub","styleNode","document","window","states","start","loading","ready","typesetting","error","typesets","state","src","flush_typesets","length","jaxs","items","forEach","item","script","createElement","div","type","text","style","position","top","left","appendChild","body","push","Queue","styleNodes","sn","querySelectorAll","Array","prototype","filter","call","n","sheet","cssRules","selectorText","result","firstElementChild","tagName","removeChild","load_library","MathJax","skipStartupTypeset","showMathMenu","jax","TeX","extensions","AuthorInit","Hub","Register","StartupHook","async","onerror","console","warn","head","LrnMathController","HTMLElement","this","hasAttribute","getAttribute","math","displayMode","cb","customElements","define","handler","TAG_NAME","CONTROLLER_TAG_NAME","mutation_config","childList","characterData","attributes","subtree","update","elem","sdom","shadowRoot","textContent","trim","isBlock","check","_private","firstChild","typeset","melem","cloneNode","LrnMath","attachShadow","mode","querySelector","setAttribute","contains","undefined","requestAnimationFrame","func","wait","timeout","observer","MutationObserver","args","clearTimeout","setTimeout","observe","name","oldValue","newValue","container","innerText","innerHTML","removeAttribute","clone","parentNode","insertBefore","remove","disconnect","canScale","canPosition","canEditSource","gizmo","title","description","icon","iconLib","color","groups","handles","meta","author","inlineOnly","settings","quick","configure","slot","inputMethod","advanced","tag"],"mappings":"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"}