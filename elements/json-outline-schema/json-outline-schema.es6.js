import{JSONOutlineSchemaItem}from"./lib/json-outline-schema-item.js";window.JSONOutlineSchema=window.JSONOutlineSchema||{};window.JSONOutlineSchema.requestAvailability=()=>{if(!window.JSONOutlineSchema.instance){window.JSONOutlineSchema.instance=document.createElement("json-outline-schema");document.body.appendChild(window.JSONOutlineSchema.instance)}return window.JSONOutlineSchema.instance};class JsonOutlineSchema extends HTMLElement{get html(){return`
<style>:host {
  display: block;
  font-family: monospace;
  white-space: pre;
  margin: 1em 0px;
}

:host([hidden]) {
  display: none;
}
</style>
<slot></slot>`}static get properties(){return{}}static get tag(){return"json-outline-schema"}constructor(delayRender=!1){super();this.tag=JsonOutlineSchema.tag;this._queue=[];this.template=document.createElement("template");this.attachShadow({mode:"open"});if(!delayRender){this.render()}this.tag=JsonOutlineSchema.tag;this.file=null;this.id=this.generateUUID();this.title="New site";this.author="";this.description="";this.license="by-sa";this.metadata={};this.items=[];this.__debug=!1;window.JSONOutlineSchema.instance=this}connectedCallback(){if(window.ShadyCSS){window.ShadyCSS.styleElement(this)}if(this._queue.length){this._processQueue()}window.addEventListener("json-outline-schema-debug-toggle",this._toggleDebug.bind(this));const evt=new CustomEvent("json-outline-schema-ready",{bubbles:!0,cancelable:!1,detail:!0});this.dispatchEvent(evt)}_copyAttribute(name,to){const recipients=this.shadowRoot.querySelectorAll(to),value=this.getAttribute(name),fname=null==value?"removeAttribute":"setAttribute";for(const node of recipients){node[fname](name,value)}}_queueAction(action){this._queue.push(action)}_processQueue(){this._queue.forEach(action=>{this[`_${action.type}`](action.data)});this._queue=[]}_setProperty({name,value}){this[name]=value}render(){this.shadowRoot.innerHTML=null;this.template.innerHTML=this.html;if(window.ShadyCSS){window.ShadyCSS.prepareTemplate(this.template,this.tag)}this.shadowRoot.appendChild(this.template.content.cloneNode(!0))}disconnectedCallback(){window.removeEventListener("json-outline-schema-debug-toggle",this._toggleDebug.bind(this));const evt=new CustomEvent("json-outline-schema-unready",{bubbles:!0,cancelable:!1,detail:!0});this.dispatchEvent(evt)}newItem(){return new JSONOutlineSchemaItem}addItem(item){let safeItem=this.validateItem(item);count=array_push(this.items,safeItem);return count}validateItem(item){let tmp=new JSONOutlineSchemaItem;for(var key in tmp){if(typeof item[key]!==typeof void 0){tmp[key]=item[key]}}return tmp}removeItem(id){for(var key in this.items){if(this.items[key].id==id){let tmp=this.items[key];delete this.items[key];return tmp}}return!1}updateItem(item,save=!1){let safeItem=this.validateItem(item);for(var key in this.items){if(this.items[key].id==safeItem.id){this.items[key]=safeItem;if(save){return this.save()}return!0}}return!1}load(location){if(file_exists(location)){this.file=location;let fileData=json_decode(file_get_contents(location));for(var key in fileData){if(typeof this[key]!==typeof void 0&&"items"!==key){this[key]=fileData[key]}}if(isset(fileData.items)){for(var key in fileData.items){let newItem=new JSONOutlineSchemaItem;newItem.id=item.id;newItem.indent=item.indent;newItem.location=item.location;newItem.order=item.order;newItem.parent=item.parent;newItem.title=item.title;newItem.description=item.description;newItem.metadata=item.metadata;this.items[key]=newItem}}return!0}return!1}save(){let schema={id:this.id,title:this.title,author:this.author,description:this.description,license:this.license,metadata:this.metadata,items:this.items};return JSON.stringify(schema,null,2)}generateUUID(){return"ss-s-s-s-sss".replace(/s/g,this._uuidPart)}_uuidPart(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}_toggleDebug(e){this.__debug=!this.__debug;this._triggerDebugPaint(this.__debug)}_triggerDebugPaint(debug){if(debug){let obj={file:this.file,id:this.id,title:this.title,author:this.author,description:this.description,license:this.license,metadata:this.metadata,items:this.items},span=document.createElement("span");span.innerHTML=JSON.stringify(obj,null,2);this.shadowRoot.appendChild(span.cloneNode(!0))}else{this.render()}}static get observedAttributes(){return["file","id","title","author","description","license","metadata"]}attributeChangedCallback(attr,oldValue,newValue){if(this.__debug){this.render();this._triggerDebugPaint(this.__debug)}}get file(){return this.getAttribute("file")}set file(newValue){this.setAttribute("file",newValue)}get id(){return this.getAttribute("id")}set id(newValue){this.setAttribute("id",newValue)}get title(){return this.getAttribute("title")}set title(newValue){this.setAttribute("title",newValue)}get author(){return this.getAttribute("author")}set author(newValue){this.setAttribute("author",newValue)}get description(){return this.getAttribute("description")}set description(newValue){this.setAttribute("description",newValue)}get license(){return this.getAttribute("license")}set license(newValue){this.setAttribute("license",newValue)}get metadata(){console.log(JSON.parse(this.getAttribute("metadata")));return JSON.parse(this.getAttribute("metadata"))}set metadata(newValue){this.setAttribute("metadata",JSON.stringify(newValue))}updateMetadata(key,value){this.metadata[key]=value}}window.customElements.define(JsonOutlineSchema.tag,JsonOutlineSchema);export{JsonOutlineSchema};