!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("lit-element/lit-element.js")):"function"==typeof define&&define.amd?define(["exports","lit-element/lit-element.js"],e):e((t=t||self).UndoManager={},t.litElement_js)}(this,function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function i(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)}return n}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach(function(e){c(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var n,o=s(t);if(e){var i=s(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return l(this,n)}}function f(t,e,n){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}(t,e);if(o){var i=Object.getOwnPropertyDescriptor(o,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function k(){var t,e,n=(t=["<slot></slot>"],e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}})));return k=function(){return n},n}var p=function(t){return function(e){u(c,t);var o=h(c);function c(){var t;return n(this,c),(t=o.call(this)).__StackDebounce,t.undoStackLimit=20,t.undoStackTimer=300,t.undoStackIgnore=!1,t.undoStackObserver=null,t.undoStackObserverProps={attributes:!0,attributeOldValue:!0,childList:!0,characterData:!0,characterDataOldValue:!0,subtree:!0},t.undoStackInitialValue=t.innerHTML,t.undoStackPrevValue=t.undoStackInitialValue,t}return i(c,null,[{key:"properties",get:function(){return a(a({},f(s(c),"properties",this)),{},{canUndo:{type:Boolean,attribute:"can-undo"},canRedo:{type:Boolean,attribute:"can-redo"},undoStackObserverProps:{type:Object},target:{type:Object},stack:{type:Object}})}}]),i(c,[{key:"pathFromUrl",value:function(t){return t.substring(0,t.lastIndexOf("/")+1)}},{key:"connectedCallback",value:function(){var t=this;this.undoStackObserver=new MutationObserver(function(e){clearTimeout(t.__StackDebounce),t.__StackDebounce=setTimeout(function(){t.undoStackIgnore?t.undoStackIgnore=!1:t.undoManagerStackLogic(e)},t.undoStackTimer)}),this.undoStackObserver.observe(this,this.undoStackObserverProps),this.undoManagerStackLogic({}),f(s(c.prototype),"connectedCallback",this).call(this)}},{key:"undoManagerStackLogic",value:function(t){var e=this.innerHTML;this.undoStack&&""!=e&&e!=this.undoStackPrevValue&&this.undoStackInitialValue!=e&&(this.undoStack.execute(new y(this,this.undoStackPrevValue,e)),this.undoStackPrevValue=e,this.dispatchEvent(new CustomEvent("stack-changed",{detail:{value:this.undoStack},bubbles:!0,composed:!0})))}},{key:"disconnectedCallback",value:function(){this.undoObserver.disconnect(),f(s(c.prototype),"disconnectedCallback",this).call(this)}},{key:"firstUpdated",value:function(t){var e=this;f(s(c.prototype),"firstUpdated",this)&&f(s(c.prototype),"firstUpdated",this).call(this,t),this.undoStack=new b,this.undoStack.undoStackLimit=this.undoStackLimit,this.undoStack.undoStackPosition=-1,this.undoStack.commands=[],this.undoStack.changed=function(t){e.canRedo=e.undoStack.canRedo(),e.canUndo=e.undoStack.canUndo()},this.undoStack.changed()}},{key:"updated",value:function(t){var e=this;f(s(c.prototype),"updated",this)&&f(s(c.prototype),"updated",this).call(this,t),t.forEach(function(t,n){"canUndo"==n&&e.dispatchEvent(new CustomEvent("can-undo-changed",{detail:{value:e[n]},bubbles:!0,composed:!0})),"canRedo"==n&&e.dispatchEvent(new CustomEvent("can-redo-changed",{detail:{value:e[n]},bubbles:!0,composed:!0}))})}},{key:"undo",value:function(){return this.undoStack.undo()}},{key:"redo",value:function(){return this.undoStack.redo()}},{key:"commands",value:function(){return this.undoStack.commands}}]),c}()},m=function(t){u(c,p(e.LitElement));var o=h(c);function c(){return n(this,c),o.apply(this,arguments)}return i(c,[{key:"render",value:function(){return e.html(k())}}],[{key:"tag",get:function(){return"undo-manager"}}]),c}();customElements.define("undo-manager",m);var b=function(){function t(){n(this,t),this.commands=[],this.undoStackPosition=-1,this.undoStackLimit=20}return i(t,[{key:"execute",value:function(t){this._clearRedo(),t.execute(),this.undoStackLimit==this.commands.length?this.commands.splice(Math.round(this.commands.length/3),1):this.undoStackPosition++,this.commands.push(t),this.changed()}},{key:"undo",value:function(){this.commands[this.undoStackPosition]&&(this.commands[this.undoStackPosition].undo(),this.undoStackPosition--,this.changed())}},{key:"canUndo",value:function(){return this.undoStackPosition>=0}},{key:"redo",value:function(){this.commands[this.undoStackPosition+1]&&(this.undoStackPosition++,this.commands[this.undoStackPosition].redo(),this.changed())}},{key:"canRedo",value:function(){return this.undoStackPosition<this.commands.length-1}},{key:"_clearRedo",value:function(){this.commands=this.commands.slice(0,this.undoStackPosition+1)}},{key:"changed",value:function(){}}]),t}(),y=function(){function t(e,o,i){n(this,t),this.el=e,this.oldValue=o,this.newValue=i}return i(t,[{key:"execute",value:function(){}},{key:"undo",value:function(){this.el.undoStackIgnore=!0,this.el.undoStack.commands&&this.el.undoStack.commands[this.el.undoStack.undoStackPosition-1]?this.el.innerHTML=this.el.undoStack.commands[this.el.undoStack.undoStackPosition-1].newValue:this.el.undoStack.commands&&0===this.el.undoStack.undoStackPosition?this.el.innerHTML=this.el.undoStackInitialValue:this.el.innerHTML=this.oldValue}},{key:"redo",value:function(){this.el.undoStackIgnore=!0,this.el.innerHTML=this.newValue}}]),t}();t.Undo=b,t.UndoManager=m,t.UndoManagerBehaviors=p,t.UndoManagerCommand=y,Object.defineProperty(t,"__esModule",{value:!0})});
