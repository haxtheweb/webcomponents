{"version":3,"file":"lunr-search.umd.js","sources":["lunr-search.umd.js"],"sourcesContent":["/**\n * Inspired by https://github.com/olivernn/lunr.js\n * Copyright 2019 The Pennsylvania State University\n * @license Apache-2.0, see License.md for full text.\n */\nimport { html, PolymerElement } from \"@polymer/polymer/polymer-element.js\";\nimport { pathFromUrl } from \"@polymer/polymer/lib/utils/resolve-url.js\";\nimport { ESGlobalBridge } from \"@lrnwebcomponents/es-global-bridge/es-global-bridge.js\";\nimport \"@polymer/iron-ajax/iron-ajax.js\";\n/**\n * `lunr-search`\n * `LunrJS search element`\n *\n * @microcopy - language worth noting:\n *  -\n *\n * @customElement\n * @polymer\n * @demo demo/index.html\n */\nclass LunrSearch extends PolymerElement {\n  \n  // render function\n  static get template() {\n    return html`\n<style>:host {\n  display: block;\n}\n\n:host([hidden]) {\n  display: none;\n}\n</style>\n<iron-ajax\n  auto\n  url=\"[[dataSource]]\"\n  method=\"[[method]]\"\n  handle-as=\"json\"\n  on-response=\"_dataResponse\"\n></iron-ajax>`;\n  }\n\n  // properties available to the custom element for data binding\n  static get properties() {\n    return {\n  \"dataSource\": {\n    \"name\": \"dataSource\",\n    \"type\": \"String\"\n  },\n  \"data\": {\n    \"name\": \"data\",\n    \"type\": \"Array\",\n    \"notify\": true\n  },\n  \"method\": {\n    \"name\": \"method\",\n    \"type\": \"String\",\n    \"value\": \"GET\"\n  },\n  \"search\": {\n    \"type\": \"String\",\n    \"notify\": true\n  },\n  \"results\": {\n    \"type\": \"Array\",\n    \"computed\": \"searched(data, search, index, minScore, limit)\",\n    \"notify\": true\n  },\n  \"noStopWords\": {\n    \"type\": \"Boolean\",\n    \"value\": false,\n    \"notify\": true\n  },\n  \"fields\": {\n    \"type\": \"Array\",\n    \"value\": []\n  },\n  \"indexNoStopWords\": {\n    \"type\": \"Object\"\n  },\n  \"index\": {\n    \"type\": \"Object\",\n    \"computed\": \"_createIndex(data, fields, noStopWords, __lunrLoaded)\"\n  },\n  \"__lunrLoaded\": {\n    \"type\": \"Boolean\"\n  },\n  \"limit\": {\n    \"type\": \"Number\",\n    \"value\": 500\n  },\n  \"minScore\": {\n    \"type\": \"Number\",\n    \"value\": 0\n  },\n  \"log\": {\n    \"type\": \"Boolean\",\n    \"value\": false\n  }\n}\n;\n  }\n  constructor() {\n    super();\n    const name = \"lunr\";\n    const basePath = pathFromUrl(import.meta.url);\n    const location = `${basePath}../../lunr/lunr.js`;\n    window.addEventListener(\n      `es-bridge-${name}-loaded`,\n      this._lunrLoaded.bind(this)\n    );\n    window.ESGlobalBridge.requestAvailability();\n    window.ESGlobalBridge.instance.load(name, location);\n    if (window.ESGlobalBridge.imports && window.ESGlobalBridge.imports[name]) {\n      this.__lunrLoaded = true;\n    }\n  }\n  _lunrLoaded(e) {\n    // callback when loaded\n    this.__lunrLoaded = true;\n  }\n  /**\n   * Store the tag name to make it easier to obtain directly.\n   * @notice function name must be here for tooling to operate correctly\n   */\n  static get tag() {\n    return \"lunr-search\";\n  }\n  _dataResponse(e) {\n    this.set(\"data\", e.detail.response);\n    this.notifyPath(\"data.*\");\n  }\n  /**\n    Filters your input data\n    \n    @param {Array} data Array of Objects with common properties.\n    @param {String} search The search term that filters results.\n    @param {Object} index The lunr Index..\n    @param {Number} minScore The minimum score of your results.\n    @param {Number} limit The maximum number of results you'd like your results.\n    \n    @return {Array} The filtered data.\n   */\n  searched(data, search, index, minScore, limit) {\n    if (data && index && search) {\n      var results = [];\n      if (\"\" + search !== \"\") {\n        var searched = index.search(search);\n        for (var i = 0; i < searched.length; i++) {\n          if (i === limit || searched[i].score < minScore) {\n            break;\n          }\n          // match on the id within the array of options\n          let tmpItem = data.find(j => j.id == searched[i].ref);\n          results.push(tmpItem);\n        }\n      }\n      if (results.length === 0 && !this.noStopWords && \"\" + search !== \"\") {\n        if (!this.indexNoStopWords) {\n          this.indexNoStopWords = this._createIndex(\n            data,\n            this.fields,\n            true,\n            index\n          );\n        }\n        searched = this.indexNoStopWords.search(search);\n        var results = [];\n        for (var i = 0; i < searched.length; i++) {\n          if (i === limit || searched[i].score < minScore) {\n            break;\n          }\n          let tmpItem = data.find(j => j.id == searched[i].ref);\n          results.push(tmpItem);\n        }\n      }\n      return results;\n    }\n  }\n  _createIndex(data, fields, noStopWords, ready) {\n    if (ready) {\n      let root = this;\n      if (Array.isArray(data) && data.length > 0) {\n        if (Array.isArray(fields) && fields.length > 0) {\n          return lunr(function() {\n            for (var i = 0; i < fields.length; i++) {\n              if (fields[i].charAt(0) === fields[i].charAt(0).toUpperCase()) {\n                this.field(fields[i], { boost: 10 });\n              } else {\n                this.field(fields[i]);\n              }\n            }\n            for (var i = 0; i < data.length; i++) {\n              var toIndex = { id: i };\n              for (var f = 0; f < fields.length; f++) {\n                if (\n                  data[i].hasOwnProperty(fields[f]) &&\n                  data[i][fields[f]] !== null &&\n                  typeof data[i][fields[f]].toString == \"function\" &&\n                  (data[i][fields[f]].toString().split(\" \").length > 2 ||\n                    data[i][fields[f]].toString().length < 30)\n                ) {\n                  //indicate that they might be words in it\n                  toIndex[fields[f]] = data[i][fields[f]].toString();\n                } else {\n                  toIndex[fields[f]] = \"\";\n                }\n              }\n              this.add(toIndex);\n            }\n            if (noStopWords) {\n              this.pipeline.remove(lunr.stopWordFilter);\n            }\n          });\n        } else {\n          // find fields\n          // TODO only word best fields.\n          var fields = [];\n          var ddup = {};\n          return lunr(function() {\n            for (\n              var indexOfData = 0;\n              indexOfData < data.length;\n              indexOfData++\n            ) {\n              for (var prop in data[indexOfData]) {\n                if (\n                  prop.charAt(0) !== \"_\" &&\n                  !ddup.hasOwnProperty(prop) &&\n                  (prop.toString().split(\" \").length > 2 ||\n                    prop.toString().length < 30)\n                ) {\n                  fields.push(prop);\n                  if (prop.charAt(0) === prop.charAt(0).toUpperCase()) {\n                    this.field(prop, { boost: 10 });\n                  } else {\n                    this.field(prop);\n                  }\n                  ddup[prop] = 1;\n                }\n              }\n            }\n            if (fields.length > 0) {\n              root.fields = fields;\n            }\n            for (var i = 0; i < data.length; i++) {\n              var toIndex = { id: i };\n              for (var f = 0; f < fields.length; f++) {\n                if (\n                  data[i].hasOwnProperty(fields[f]) &&\n                  data[i][fields[f]] !== null &&\n                  typeof data[i][fields[f]].toString == \"function\" &&\n                  (data[i][fields[f]].toString().split(\" \").length > 2 ||\n                    data[i][fields[f]].toString().length < 30)\n                ) {\n                  //indicate that they might be words in it\n                  toIndex[fields[f]] = data[i][fields[f]].toString();\n                } else {\n                  toIndex[fields[f]] = \"\";\n                }\n              }\n              this.add(toIndex);\n            }\n            if (noStopWords) {\n              this.pipeline.remove(lunr.stopWordFilter);\n            }\n          });\n        }\n      }\n    }\n  }\n}\nwindow.customElements.define(LunrSearch.tag, LunrSearch);\nexport { LunrSearch };\n"],"names":["LunrSearch","basePath","pathFromUrl","location","window","addEventListener","_this","_lunrLoaded","bind","ESGlobalBridge","requestAvailability","instance","load","imports","__lunrLoaded","PolymerElement","html","e","set","detail","response","notifyPath","data","search","index","minScore","limit","results","searched","i","length","score","tmpItem","find","j","id","ref","push","this","noStopWords","indexNoStopWords","_createIndex","fields","ready","root","Array","isArray","lunr","charAt","toUpperCase","field","boost","toIndex","f","hasOwnProperty","toString","split","add","pipeline","remove","stopWordFilter","ddup","indexOfData","prop","customElements","define","tag"],"mappings":"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"}